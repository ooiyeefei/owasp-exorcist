---
inclusion: manual
---

# Vulnerability Template Design Rules

## Pattern Contamination Prevention

When creating or modifying vulnerability templates, **avoid using the vulnerable pattern in display text**. This prevents false positives in the detection system.

### ❌ What NOT to Do

Don't include the detection pattern in:
- Component titles (`<h3>`)
- Hint text
- Educational descriptions
- AWS service explanations
- Any JSX string content

**Example of BAD template:**
```tsx
<h3>XSS via dangerouslySetInnerHTML</h3>
<p>Hint: Search for 'dangerouslySetInnerHTML' in code</p>
<p>Using dangerouslySetInnerHTML is dangerous...</p>
```

### ✅ What TO Do

Use generic, descriptive terms in display text:

**Example of GOOD template:**
```tsx
<h3>XSS Vulnerability</h3>
<p>Hint: Search for unsafe HTML rendering</p>
<p>Unsafe HTML rendering is dangerous...</p>
```

## Why This Matters

The detection system uses regex patterns to scan files for vulnerable code. If the pattern appears in JSX strings or comments, the detection hook will match display text instead of actual vulnerable code, causing false positives.

### The Problem

```typescript
// Detection pattern: eval\s*\(

// ❌ This will trigger false positive:
<h3>Code Injection via eval()</h3>  // Pattern matches here!
<p>Search for 'eval(' in code</p>   // And here!

// ✅ This won't trigger false positive:
<h3>Code Injection Vulnerability</h3>
<p>Search for dynamic code execution</p>
```

## Template Design Checklist

When creating a new vulnerability template:

- [ ] Component title uses generic terms (not the exact pattern)
- [ ] Hints describe what to look for without using the exact pattern
- [ ] Educational content uses alternative phrasing
- [ ] AWS descriptions avoid the vulnerable pattern
- [ ] Test the template with the detection hook before deployment

## Pattern Naming Guidelines

### For Code Patterns

| Vulnerable Pattern | Display Name |
|-------------------|--------------|
| `eval()` | "Dynamic code execution" or "Code Injection Vulnerability" |
| `dangerouslySetInnerHTML` | "Unsafe HTML rendering" or "XSS Vulnerability" |
| `${userId}` in SQL | "String concatenation in queries" or "SQL Injection" |
| Hardcoded `API_KEY` | "Hardcoded credentials" or "Exposed secrets" |

### For Hints

Instead of: "Search for 'eval(' in the codebase"  
Use: "Search for dynamic code execution" or "Look for functions that execute user input"

Instead of: "Look for 'dangerouslySetInnerHTML'"  
Use: "Look for unsafe HTML rendering" or "Check where user input becomes HTML"

## Detection Pattern Best Practices

### 1. Use Context-Aware Patterns

```javascript
// ❌ Too broad - matches strings
pattern: "eval\\s*\\("

// ✅ Better - looks for code context
pattern: "(?:const|let|var|return)\\s+.*?eval\\s*\\("
```

### 2. Use Comment-Based Detection

For complex patterns, use comment markers:

```javascript
{
  type: 'comment',
  pattern: 'No input validation implemented',
  fixIndicators: ['.parse(', '.validate(', 'z.object']
}
```

### 3. Test Detection Before Deployment

Always test that:
- The pattern detects the actual vulnerability
- The pattern doesn't match display text
- Fix indicators properly mark the vulnerability as fixed

## Template Validation

Before adding a template to production:

1. **Generate a test component** from the template
2. **Run the detection hook** - should detect as vulnerable
3. **Apply the fix** from the template
4. **Run the detection hook again** - should detect as fixed
5. **Verify no false positives** from display text

## Examples

### Good Template Structure

```json
{
  "name": "Code Injection Vulnerability",
  "hints": {
    "easy": [
      "Search for dynamic code execution",
      "Look for functions that execute user input"
    ]
  },
  "educationalContent": {
    "analogy": "Dynamic code execution is like...",
    "preventionTip": "Never execute user input as code..."
  }
}
```

### Detection Configuration

```json
{
  "detection": {
    "type": "regex",
    "pattern": "eval\\s*\\(",
    "description": "Look for code execution functions",
    "fixIndicators": [
      "Code execution disabled",
      "safe alternative"
    ]
  }
}
```

## Common Pitfalls

1. **Using the exact pattern in titles** - Causes false positives
2. **Mentioning the pattern in hints** - Detection matches hint text
3. **Educational content with code examples** - Use generic terms
4. **Not testing detection** - Deploy broken templates

## Quick Reference

**Before committing a template, ask:**
- Does the title contain the detection pattern? → Change it
- Do hints mention the exact pattern? → Use generic terms
- Does educational content include the pattern? → Rephrase
- Have I tested detection? → Test before deploying

---

## For Developers

When modifying the game:

1. **Template changes** → Update this guide
2. **Detection changes** → Document new patterns here
3. **New vulnerability types** → Follow these rules
4. **Bug fixes** → Check if template design caused it

Remember: **Generic display text + Specific detection patterns = Reliable game experience**
